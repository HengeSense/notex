{% extends "base.html" %}

{% block main %}
<script type="text/javascript">
Ext.onReady (function () {

    Ext.QuickTips.init ();

    var session = {
        id: '{{ sid }}'
      , timestamp: '{{ timestamp }}'
    }

    if (typeof (console) != 'undefined') {
        console.info (session)
    }

    /**
     * pnlLhs -----------------------------------------------------------------
     */

    var pnlTree = {
        xtype       : 'treepanel'
      , autoScroll  : true
      , rootVisible : false

      , loader : new Ext.tree.TreeLoader({
            url : '{% url editor:post.tree %}'
        })

      , root : {
            text     : 'Root'
          , id       : 'LMRHE33POQRCYIC3LVOQ====' //[u'root', []]
          , cls      : 'folder'
          , iconCls  : 'icon-folder'
          , expanded : true
        }

      , listeners : {
            dblclick : function (node, event) {
                if (node.attributes['cls'] == "file") {
                    Ext.getCmp ('pnlRhsId').fireEvent ('show_tab', node)
                }
            }
        }
    }

    var pnlLhs = {
        title  : 'Project Manager'
      , layout : 'fit'

      , tools  : [{
            id      : 'refresh'
          , qtip    : '<b>Refresh</b><br/>Refresh project manager\'s view'
          , handler : function (event, toolEl, panel) {
                //@TODO!
            }
        }]

      , tbar : {
            items : [{
                iconCls : 'icon-disk_download'
              , tooltip : '<b>Import</b><br/>Open a project (from <i>local</i> storage)'
            },{
                iconCls : 'icon-disk_upload'
              , tooltip : '<b>Export</b><br/>Save selected project (to <i>local</i> storage)'
            },'-',{
                iconCls : 'icon-folder_page'
              , tooltip : '<b>Open</b><br/>Open a text/image file (from <i>local</i> storage)'
            },{
                iconCls : 'icon-disk'
              , tooltip : '<b>Save</b><br/>Save selected file (to <i>remote</i> storage)'
            },{
                iconCls : 'icon-disk_multiple'
              , tooltip : '<b>Save All</b><br/>Save all files (to <i>remote</i> storage)'
            },'-',{
                iconCls : 'icon-add'
              , tooltip : '<b>Add</b><br/>Add a new project, folder or file'
              , split   : true
              , menu    : {
                  xtype : 'menu'
                , plain : true

                , items : [{
                      iconCls : 'icon-report'
                    , text    : 'Project'
                  },{
                      iconCls : 'icon-folder'
                    , text    : 'Folder'
                  },'-',{
                      iconCls : 'icon-page'
                    , text    : 'Plain Text'
                  }]

                }
            },{
                iconCls : 'icon-pencil'
              , tooltip : '<b>Rename</b><br/>Rename selected project, folder or file'
            },{
                iconCls : 'icon-delete'
              , tooltip : '<b>Delete</b><br/>Delete selected project, folder or file'
            },'-',{
                iconCls : 'icon-arrow_up'
              , tooltip : '<b>Move Up</b><br/>Move selected project, folder or file up in tree'
            },{
                iconCls : 'icon-arrow_down'
              , tooltip : '<b>Move Down</b><br/>Move selected project, folder or file down in tree'
            }]
        }

      , items : [pnlTree]
      /*
      , listeners : [{
            click : function (a, b, c, d) {
                if (typeof (console) != 'undefined') {
                    console.info (a, b, c, d)
                }
            }
        }]*/
    }

    /**
     * pnlRhs -----------------------------------------------------------------
     */

    var tabText = {

        title      : 'Plain'
      , layout     : 'fit'
      , autoScroll : true
      , iconCls    : 'icon-page_white_text'
      , closable   : true

      , items : [{
            xtype  : 'htmleditor',
            anchor : '100% 100%'
      }]

    }

    var tabLatex = {

        title      : 'Latex'
      , layout     : 'fit'
      , autoScroll : true
      , iconCls    : 'icon-page_white_code'
      , closable   : true

      , items : [{
            layout       : 'hbox'
          , layoutConfig : { align : 'middle', pack: 'center' }
          , items : [{
                width  : 128
              , height : 128
              , html   : '<img \
                    src="{{ MEDIA_URL }}img/mid/under_construction.jpg">'
          }]
      }]

    }

    var tabPdf = {

        title      : 'PDF'
      , layout     : 'fit'
      , autoScroll : true
      , iconCls    : 'icon-page_white_acrobat'
      , closable   : true

      , items : [{
            layout       : 'hbox'
          , layoutConfig : { align : 'middle', pack: 'center' }
          , items : [{
                width  : 128
              , height : 128
              , html   : '<img \
                    src="{{ MEDIA_URL }}img/mid/under_construction.jpg">'
          }]
      }]

    }

    var tabHtml = {

        title      : 'HTML'
      , layout     : 'fit'
      , autoScroll : true
      , iconCls    : 'icon-page_white_code_red'
      , closable   : true

      , items : [{
            layout       : 'hbox'
          , layoutConfig : { align : 'middle', pack: 'center' }
          , items : [{
                width  : 128
              , height : 128
              , html   : '<img \
                    src="{{ MEDIA_URL }}img/mid/under_construction.jpg">'
          }]
      }]

    }

    var tabView = {

        title      : 'HTML View'
      , layout     : 'fit'
      , autoScroll : true
      , iconCls    : 'icon-page_white_world'
      , closable   : true

      , items : [{
            layout       : 'hbox'
          , layoutConfig : { align : 'middle', pack: 'center' }
          , items : [{
                width  : 128
              , height : 128
              , html   : '<img \
                    src="{{ MEDIA_URL }}img/mid/under_construction.jpg">'
          }]
      }]

    }

    var pnlRhs = new Ext.TabPanel({

        activeTab       : 0
      , id              : 'pnlRhsId'
      , enableTabScroll : true
      , tabPosition     : 'bottom'

      , items           : [
        ]

      , listeners : {
            show_tab: function (node) {
                if (typeof(console) != 'undefined') {
                    console.info (node)
                }

                var tab = this.findById (node.id)
                if (!tab) {
                    tab = this.add({
                        title      : node.attributes['text']
                      , id         : node.id
                      , layout     : 'fit'
                      , autoScroll : true
                      , iconCls    : node.attributes['iconCls']
                      , closable   : true

                      , items : [{
                            xtype  : 'htmleditor'
                          , anchor : '100% 100%'
                          , html   : node.attributes['data']
                      }]
                    })
                }
                
                this.activate (tab)
            }
        }
    });

    /**
     * viewport ---------------------------------------------------------------
     */

    var viewport = new Ext.Viewport({

        layout : 'border'
      , id     : 'viewportId'

      , items : [{
            region : 'center'
          , layout : 'fit'
          , items  : [pnlRhs]

      },{
            region       : 'west'
          , split        : true
          , minWidth     : 268
          , width        : 268
          , collapsed    : false
          , collapseMode : 'mini'
          , hidden       : false
          , layout       : 'fit'
          , items        : [pnlLhs]
      }]
    });

    viewport.show ();

});</script>
{% endblock %}
